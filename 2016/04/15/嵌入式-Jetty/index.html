<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhang-jc.github.io","root":"/","images":"/images","scheme":"Mist","version":"8.6.1","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Jetty 有一个口号，“不要在 Jetty 中部署你的应用，部署 Jetty 在你的应用中！”这个口号意味着构建应用为为标准的 WAR 并且部署到 Jetty 的另外一个选择是，Jetty 被设计为一个软件组件，可以在 Java 程序中像其他 POJO 一样被实例化和使用。换一种方式，以嵌入式模式运行 Jetty 意味着放置一个 HTTP 模块到你的应用中，而不是放置你的应用到 HTTP 服务器">
<meta property="og:type" content="article">
<meta property="og:title" content="嵌入式 Jetty">
<meta property="og:url" content="http://zhang-jc.github.io/2016/04/15/%E5%B5%8C%E5%85%A5%E5%BC%8F-Jetty/index.html">
<meta property="og:site_name" content="一张假钞的真实世界">
<meta property="og:description" content="Jetty 有一个口号，“不要在 Jetty 中部署你的应用，部署 Jetty 在你的应用中！”这个口号意味着构建应用为为标准的 WAR 并且部署到 Jetty 的另外一个选择是，Jetty 被设计为一个软件组件，可以在 Java 程序中像其他 POJO 一样被实例化和使用。换一种方式，以嵌入式模式运行 Jetty 意味着放置一个 HTTP 模块到你的应用中，而不是放置你的应用到 HTTP 服务器">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-04-15T07:38:23.000Z">
<meta property="article:modified_time" content="2021-07-19T16:28:00.308Z">
<meta property="article:author" content="一张假钞">
<meta property="article:tag" content="Jetty">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://zhang-jc.github.io/2016/04/15/%E5%B5%8C%E5%85%A5%E5%BC%8F-Jetty/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://zhang-jc.github.io/2016/04/15/%E5%B5%8C%E5%85%A5%E5%BC%8F-Jetty/","path":"2016/04/15/嵌入式-Jetty/","title":"嵌入式 Jetty"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>嵌入式 Jetty | 一张假钞的真实世界</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?94b1e62b5b593fa5e1e026e280b9db7e"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">一张假钞的真实世界</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Server"><span class="nav-number">2.</span> <span class="nav-text">创建 Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">使用处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HelloWorld-Handler"><span class="nav-number">3.1.</span> <span class="nav-text">HelloWorld Handler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C-HelloWorldHandler"><span class="nav-number">3.2.</span> <span class="nav-text">运行 HelloWorldHandler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Handler-Collections-and-Wrappers"><span class="nav-number">3.3.</span> <span class="nav-text">Handler Collections and Wrappers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">3.4.</span> <span class="nav-text">处理器的作用域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Resource-Handler"><span class="nav-number">3.5.</span> <span class="nav-text">Resource Handler</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F-Connectors"><span class="nav-number">4.</span> <span class="nav-text">嵌入式 Connectors</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA-Connector"><span class="nav-number">4.1.</span> <span class="nav-text">一个 Connector</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA-Connectors"><span class="nav-number">4.2.</span> <span class="nav-text">多个 Connectors</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5-Servlets"><span class="nav-number">5.</span> <span class="nav-text">嵌入 Servlets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5-Contexts"><span class="nav-number">6.</span> <span class="nav-text">嵌入 Contexts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5-ServletContexts"><span class="nav-number">7.</span> <span class="nav-text">嵌入 ServletContexts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5-Web-Applications"><span class="nav-number">8.</span> <span class="nav-text">嵌入 Web Applications</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%96%9C%E6%AC%A2-Jetty-XML"><span class="nav-number">9.</span> <span class="nav-text">喜欢 Jetty XML</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="一张假钞"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">一张假钞</p>
  <div class="site-description" itemprop="description">人一定要有梦想，万一实现了呢...</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">199</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhang-jc.github.io/2016/04/15/%E5%B5%8C%E5%85%A5%E5%BC%8F-Jetty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="一张假钞">
      <meta itemprop="description" content="人一定要有梦想，万一实现了呢...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一张假钞的真实世界">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          嵌入式 Jetty
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-04-15 15:38:23" itemprop="dateCreated datePublished" datetime="2016-04-15T15:38:23+08:00">2016-04-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-20 00:28:00" itemprop="dateModified" datetime="2021-07-20T00:28:00+08:00">2021-07-20</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">开发工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Jetty/" itemprop="url" rel="index"><span itemprop="name">Jetty</span></a>
        </span>
    </span>

  
    <span id="/2016/04/15/%E5%B5%8C%E5%85%A5%E5%BC%8F-Jetty/" class="post-meta-item leancloud_visitors" data-flag-title="嵌入式 Jetty" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Jetty 有一个口号，“不要在 Jetty 中部署你的应用，部署 Jetty 在你的应用中！”这个口号意味着构建应用为为标准的 WAR 并且部署到 Jetty 的另外一个选择是，Jetty 被设计为一个软件组件，可以在 Java 程序中像其他 POJO 一样被实例化和使用。换一种方式，以嵌入式模式运行 Jetty 意味着放置一个 HTTP 模块到你的应用中，而不是放置你的应用到 HTTP 服务器。</p>
<span id="more"></span>

<p>本教程将带领你一步步从最简单的 Jetty 服务器实例化到用标准化部署描述器运行多 Web 应用程序。大部分这些实例的代码是标准 Jetty 项目的一部分。</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>嵌入 Jetty 服务器，下面是通常的步骤，也是本教程实例中展示步骤：</p>
<ol>
<li>创建一个 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/Server.html">Server</a> 实例。  </li>
<li>添加/配置 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/Connector.html">Connectors</a>。  </li>
<li>添加/配置 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/Handler.html">Handlers</a>、<a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/handler/ContextHandler.html">Contexts</a>、<a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/6/api/javax/servlet/Servlet.html">Servlets</a>。  </li>
<li>启动 Server。  </li>
<li>服务器等待或者用自己的线程做一些其他的事情。</li>
</ol>
<h3 id="创建-Server"><a href="#创建-Server" class="headerlink" title="创建 Server"></a>创建 Server</h3><p>下面是 SimplestServer.java 文件的代码，实例化并且运行一个可能最简单的 Jetty server。</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;

/**
 * The simplest possible Jetty server.
 */
public class SimplestServer
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        Server server = new Server(8080);
        server.start();
        server.dumpStdErr();
        server.join();
    &#125;
&#125;
</code></pre>
<p>这将运行一个监听 8080 端口的 HTTP Server。这不是一个有用的 server，因为它没有处理器，因此对所有的请求都将返回 404。</p>
<h3 id="使用处理器"><a href="#使用处理器" class="headerlink" title="使用处理器"></a>使用处理器</h3><p>为了针对请求生成响应，Jetty 要求在服务器上设置处理器。一个处理器可能：</p>
<ul>
<li>检查/修改 HTTP 请求。</li>
<li>生成完整的 HTTP 响应。</li>
<li>调用其他处理器（见 HandlerWrapper）。</li>
<li>选择一个或者多个处理器调用（见 HandlerCollection）。</li>
</ul>
<h4 id="HelloWorld-Handler"><a href="#HelloWorld-Handler" class="headerlink" title="HelloWorld Handler"></a>HelloWorld Handler</h4><p>下面 HelloHandler.java 的代码展示了一个简单的 hello world 处理器：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;

public class HelloHandler extends AbstractHandler
&#123;
    final String greeting;
    final String body;

    public HelloHandler()
    &#123;
        this(&quot;Hello World&quot;);
    &#125;

    public HelloHandler( String greeting )
    &#123;
        this(greeting, null);
    &#125;

    public HelloHandler( String greeting, String body )
    &#123;
        this.greeting = greeting;
        this.body = body;
    &#125;

    public void handle( String target,
                        Request baseRequest,
                        HttpServletRequest request,
                        HttpServletResponse response ) throws IOException,
                                                      ServletException
    &#123;
        response.setContentType(&quot;text/html; charset=utf-8&quot;);
        response.setStatus(HttpServletResponse.SC_OK);

        PrintWriter out = response.getWriter();

        out.println(&quot;&lt;h1&gt;&quot; + greeting + &quot;&lt;/h1&gt;&quot;);
        if (body != null)
        &#123;
            out.println(body);
        &#125;

        baseRequest.setHandled(true);
    &#125;
&#125;
</code></pre>
<p>传给处理方法的参数是：</p>
<ul>
<li>target - 请求的目标，可能是一个 URI 或者被命名调度器的名称。</li>
<li>baseRequest - 可变的 Jetty 请求对象，这个对象总是未包装的。</li>
<li>request - 不变的请求对象，可能被一个过滤器或 servlet 包装过。</li>
<li>response - 响应，可能被过滤器或 servlet 包装过。</li>
</ul>
<p>处理器设置响应的状态、内容类型，并且在使用写入器生成响应体之前标记请求已经被处理。</p>
<h4 id="运行-HelloWorldHandler"><a href="#运行-HelloWorldHandler" class="headerlink" title="运行 HelloWorldHandler"></a>运行 HelloWorldHandler</h4><p>为了允许一个处理器处理 HTTP 请求，必须添加处理器到一个服务器实例中。下面 OneHandler.java 代码展示了 Jetty 服务器如何使用 HelloWrold 处理器：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;

public class OneHandler
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        Server server = new Server(8080);
        server.setHandler(new HelloHandler());

        server.start();
        server.join();
    &#125;
&#125;
</code></pre>
<p>在 Jetty 中一个或者更多处理器处理所有请求。一些处理器选择其他特定的处理器（例如，ContextHandlerCollection 使用上下文路径选择 ContextHandler）；其他处理器使用应用逻辑生成响应（例如，ServletHandler 传送请求给应用 Servlet），同时其他处理器做跟生成响应无关的任务（例如，RequestLogHandler 或者 StatisticsHandler）。</p>
<p>后面的章节描述如何结合处理器方面的问题。你可以看到在 Jetty 的 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/server/handler/package-summary.html">org.eclipse.jetty.server.handler</a> 包中有一些处理器。</p>
<h4 id="Handler-Collections-and-Wrappers"><a href="#Handler-Collections-and-Wrappers" class="headerlink" title="Handler Collections and Wrappers"></a>Handler Collections and Wrappers</h4><p>复杂的请求可以通过多种方式组合多个处理器进行处理。Jetty 有多个 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/HandlerContainer.html">HandlerContainer</a> 接口的实现：</p>
<p><strong><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/handler/HandlerCollection.html">HandlerCollection</a></strong></p>
<p>  管理其他处理器的一个集合，并且按照顺序调用每个处理器。这对组合那些生成响应的处理器和统计数据、记录日志的处理器是有用的。</p>
<p><strong><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/handler/HandlerList.html">HandlerList</a></strong></p>
<p>  轮流调用每个处理器的处理器集合，直到抛出一个异常、提交了响应或者 request.isHandled() 返回 true。你可以用它组合根据条件处理一个请求的处理器，例如调用多个上下文直到匹配一个虚拟主机。</p>
<p><strong><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/handler/HandlerWrapper.html">HandlerWrapper</a></strong></p>
<p>  处理器的基础类，你可以在面向方面编程风格中一起使用菊花链处理器。例如，一个标准的 web 应用是通过一个 context、session、security和servlet处理器链实现的。</p>
<p><strong><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/apidocs/org/eclipse/jetty/server/handler/ContextHandlerCollection.html">ContextHandlerCollection</a></strong></p>
<p>  一个特定的 HandlerCollection，使用请求 URI 最长的前缀（contextPath）选择包含的 ContextHandler 来处理请求。</p>
<h4 id="处理器的作用域"><a href="#处理器的作用域" class="headerlink" title="处理器的作用域"></a>处理器的作用域</h4><p>很多 Jetty 中的标准 Servlet 容器是用 HandlerWrappers 实现的，是一个菊花式处理器链：ContextHandler 到 SessionHandler 到 SecurityHandler 到 ServletHandler。然而，因为 servlet 规范的特性，这个链不是一个处理器的纯粹嵌套，因为外部处理器有时需要内部处理器的过程信息。例如，当 ContextHandler 调用应用监听器来通知它们一个请求进入了上下文，它必须已经知道 ServletHandler 分发请求给哪个 servlet，因此 servletPath 方法返回正确的值。</p>
<p>HandlerWrapper 被定制为 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/server/handler/ScopedHandler.html">ScopedHandler</a> 抽象类，它支持作用域的菊花链。例如，如果一个 ServletHandler 嵌套在一个 ContextHandler 中，方法的执行顺序和嵌套是：</p>
<p>Server.handle(…)<br>  ContextHandler.doScope(…)<br>    ServletHandler.doScope(…)<br>      ContextHandler.doHandle(…)<br>        ServletHandler.doHandle(…)<br>          SomeServlet.service(…)</p>
<p>因此，当 ContextHandler 处理请求的时候，它将在 ServletHandler 建立的作用域内进行。</p>
<h4 id="Resource-Handler"><a href="#Resource-Handler" class="headerlink" title="Resource Handler"></a>Resource Handler</h4><p><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/FileServer.html">FileServer</a> 示例展示了如何使用 ResourceHandler 在当前的工作目录提供静态内容服务。</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.DefaultHandler;
import org.eclipse.jetty.server.handler.HandlerList;
import org.eclipse.jetty.server.handler.ResourceHandler;
import org.eclipse.jetty.server.handler.gzip.GzipHandler;

/**
 * Simple Jetty FileServer.
 * This is a simple example of Jetty configured as a FileServer.
 */
public class FileServer
&#123;
    public static void main(String[] args) throws Exception
    &#123;
        // Create a basic Jetty server object that will listen on port 8080.  Note that if you set this to port 0
        // then a randomly available port will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Create the ResourceHandler. It is the object that will actually handle the request for a given file. It is
        // a Jetty Handler object so it is suitable for chaining with other handlers as you will see in other examples.
        ResourceHandler resource_handler = new ResourceHandler();
        // Configure the ResourceHandler. Setting the resource base indicates where the files should be served out of.
        // In this example it is the current directory but it can be configured to anything that the jvm has access to.
        resource_handler.setDirectoriesListed(true);
        resource_handler.setWelcomeFiles(new String[]&#123; &quot;index.html&quot; &#125;);
        resource_handler.setResourceBase(&quot;.&quot;);

        // Add the ResourceHandler to the server.
        GzipHandler gzip = new GzipHandler();
        server.setHandler(gzip);
        HandlerList handlers = new HandlerList();
        handlers.setHandlers(new Handler[] &#123; resource_handler, new DefaultHandler() &#125;);
        gzip.setHandler(handlers);

        // Start things up! By using the server.join() the server thread will join with the current thread.
        // See &quot;http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#join()&quot; for more details.
        server.start();
        server.join();
    &#125;
&#125;
</code></pre>
<p>注意，ResourceHandler 和 DefaultHandler 使用了一个 HandlerList，因此 DefaultHandler 为所有找不到静态资源的请求生成良好的 404 响应。</p>
<h3 id="嵌入式-Connectors"><a href="#嵌入式-Connectors" class="headerlink" title="嵌入式 Connectors"></a>嵌入式 Connectors</h3><p>在前面的示例中，Server 实例传入了一个端口号，并且在内部创建一个在这个端口监听请求的 Connector 默认实例。然而，通常当嵌入 Jetty 的时候，需要明确实例化，并且给 Server 实例配置一个或多个 Connectors。</p>
<h4 id="一个-Connector"><a href="#一个-Connector" class="headerlink" title="一个 Connector"></a>一个 Connector</h4><p>下面的示例，<a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/OneConnector.html">OneConnector.java</a>，实例化、配置并添加一个 HTTP 连接器实例到服务器：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;

/**
 * A Jetty server with one connectors.
 */
public class OneConnector
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        // The Server
        Server server = new Server();

        // HTTP connector
        ServerConnector http = new ServerConnector(server);
        http.setHost(&quot;localhost&quot;);
        http.setPort(8080);
        http.setIdleTimeout(30000);

        // Set the connector
        server.addConnector(http);

        // Set a handler
        server.setHandler(new HelloHandler());

        // Start the server
        server.start();
        server.join();
    &#125;
&#125;
</code></pre>
<p>在这个示例中，连接器处理 HTTP 协议，这是 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/server/ServerConnector.html">ServerConnector</a> 类默认的。</p>
<h4 id="多个-Connectors"><a href="#多个-Connectors" class="headerlink" title="多个 Connectors"></a>多个 Connectors</h4><p>当配置多个连接器（例如，HTTP 和 HTTPS）时，共享 HTTP 通用参数的配置是可取的。为了达到这个目的，你需要明确配置 ConnectionFactory 实例和 ServerConnector 类，并且跟 HTTP 通用配置一起提供。</p>
<p><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/ManyConnectors.html">ManyConnectors 示例</a> 配置了有两个 ServerConnector 实例的服务器：HTTP 连接器有一个 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/server/HttpConnectionFactory.html">HTTPConnectionFactory</a> 实例；HTTPS 连接器有一个链接到 HttpConnectionFactory 的 SslConnectionFactory。两个 HttpConnectionFactories 在同一个 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/server/HttpConfiguration.html">HttpConfiguration</a> 上配置，然而 HTTPS 工厂用一个包装的配置，所以可以添加 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/server/SecureRequestCustomizer.html">SecureRequestCustomizer</a>。</p>
<h3 id="嵌入-Servlets"><a href="#嵌入-Servlets" class="headerlink" title="嵌入 Servlets"></a>嵌入 Servlets</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Java_servlet">Servlets</a> 是提供处理 HTTP 请求应用逻辑的一般方式。Servlets 跟 Jetty 的处理器是相同的，除非请求对象是不可变的，因此不能被修改。在 Jetty 中 Servlets 通过一个 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/MinimalServlets.html">ServletHandler</a> 来处理。它使用标准的路径映射让 Servlet 和请求匹配；设置请求的 servletPath 和路径信息；传送请求到 servlet，可能通过 Filters 生成响应。</p>
<p><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/MinimalServlets.html">MinimalServlets 示例</a> 创建了一个 ServletHandler 实例并且配置了一个 HelloServlet:</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.ServletHandler;

public class MinimalServlets
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // The ServletHandler is a dead simple way to create a context handler
        // that is backed by an instance of a Servlet.
        // This handler then needs to be registered with the Server object.
        ServletHandler handler = new ServletHandler();
        server.setHandler(handler);

        // Passing in the class for the Servlet allows jetty to instantiate an
        // instance of that Servlet and mount it on a given context path.

        // IMPORTANT:
        // This is a raw Servlet, not a Servlet that has been configured
        // through a web.xml @WebServlet annotation, or anything similar.
        handler.addServletWithMapping(HelloServlet.class, &quot;/*&quot;);

        // Start things up!
        server.start();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See
        // http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    &#125;

    @SuppressWarnings(&quot;serial&quot;)
    public static class HelloServlet extends HttpServlet
    &#123;
        @Override
        protected void doGet( HttpServletRequest request,
                              HttpServletResponse response ) throws ServletException,
                                                            IOException
        &#123;
            response.setContentType(&quot;text/html&quot;);
            response.setStatus(HttpServletResponse.SC_OK);
            response.getWriter().println(&quot;&lt;h1&gt;Hello from HelloServlet&lt;/h1&gt;&quot;);
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="嵌入-Contexts"><a href="#嵌入-Contexts" class="headerlink" title="嵌入 Contexts"></a>嵌入 Contexts</h3><p><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/OneContext.html">ContextHandler</a> 是一个 ScopedHandler 只来响应那些 URI 前缀匹配已配置的上下文路径的请求。匹配上下文路径的请求会响应的调整它们的路径方法，并且上下文生命周期内是可获取的，可能包含：</p>
<ul>
<li>当请求在作用域内处理时，Classloader 设置为线程上下文的类加载器。</li>
<li>通过过 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html">ServletContext</a> API 可以获取属性的集合。</li>
<li>通过过 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html">ServletContext</a> API 可以获取参数的集合。</li>
<li>通过过 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContext.html">ServletContext</a> API 为静态资源的请求提供一个基本的 Resource 作为文档根。</li>
<li>虚拟主机名称集合。</li>
</ul>
<p>下面的 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/OneContext.html">OneContext 示例</a> 建立了一个包装了 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/HelloHandler.html">HelloHandler</a> 的上下文：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.ContextHandler;

public class OneContext
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        Server server = new Server( 8080 );

        // Add a single handler on context &quot;/hello&quot;
        ContextHandler context = new ContextHandler();
        context.setContextPath( &quot;/hello&quot; );
        context.setHandler( new HelloHandler() );

        // Can be accessed using http://localhost:8080/hello

        server.setHandler( context );

        // Start the server
        server.start();
        server.join();
    &#125;
&#125;
</code></pre>
<p>当有很多上下文出现时，你可以嵌入一个 ContextHandlerCollection 来有效的测试一个请求的 URI，然后选择匹配到的 ContextHandler。<a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/ManyContexts.html">ManyContexts 示例</a> 展示了可以配置多个上下文：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.ContextHandler;
import org.eclipse.jetty.server.handler.ContextHandlerCollection;

public class ManyContexts
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        Server server = new Server(8080);

        ContextHandler context = new ContextHandler(&quot;/&quot;);
        context.setContextPath(&quot;/&quot;);
        context.setHandler(new HelloHandler(&quot;Root Hello&quot;));

        ContextHandler contextFR = new ContextHandler(&quot;/fr&quot;);
        contextFR.setHandler(new HelloHandler(&quot;Bonjoir&quot;));

        ContextHandler contextIT = new ContextHandler(&quot;/it&quot;);
        contextIT.setHandler(new HelloHandler(&quot;Bongiorno&quot;));

        ContextHandler contextV = new ContextHandler(&quot;/&quot;);
        contextV.setVirtualHosts(new String[] &#123; &quot;127.0.0.2&quot; &#125;);
        contextV.setHandler(new HelloHandler(&quot;Virtual Hello&quot;));

        ContextHandlerCollection contexts = new ContextHandlerCollection();
        contexts.setHandlers(new Handler[] &#123; context, contextFR, contextIT,
                contextV &#125;);

        server.setHandler(contexts);

        server.start();
        server.join();
    &#125;
&#125;
</code></pre>
<h3 id="嵌入-ServletContexts"><a href="#嵌入-ServletContexts" class="headerlink" title="嵌入 ServletContexts"></a>嵌入 ServletContexts</h3><p><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/servlet/ServletContextHandler.html">ServletContextHandler</a> 是一个支持普通 session 和 Servlet 的特定的 ContextHandler。下面的 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/OneServletContext.html">OneServletContext 示例</a> 实例化了一个 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/servlet/DefaultServlet.html">DefaultServlet</a> 从 /tmp/ 提供静态内容，并且实例化一个 DumpServlet 创建 session 并存储请求的基本详细信息：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.servlet.DefaultServlet;
import org.eclipse.jetty.servlet.ServletContextHandler;

public class OneServletContext
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        Server server = new Server(8080);

        ServletContextHandler context = new ServletContextHandler(
                ServletContextHandler.SESSIONS);
        context.setContextPath(&quot;/&quot;);
        context.setResourceBase(System.getProperty(&quot;java.io.tmpdir&quot;));
        server.setHandler(context);

        // Add dump servlet
        context.addServlet(DumpServlet.class, &quot;/dump/*&quot;);
        // Add default servlet
        context.addServlet(DefaultServlet.class, &quot;/&quot;);

        server.start();
        server.join();
    &#125;
&#125;
</code></pre>
<h3 id="嵌入-Web-Applications"><a href="#嵌入-Web-Applications" class="headerlink" title="嵌入 Web Applications"></a>嵌入 Web Applications</h3><p><a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/webapp/WebAppContext.html">WebAppContext</a> 是一个 ServletContextHandler 的扩展，它使用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/WAR_(file_format)">标准设计</a>和 web.xml 配置 servlet、filter 和 web.xml 或注解的其他特性。下面的 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/OneWebApp.html">OneWebApp 示例</a> 配置了 Jetty 的测试 web 应用。Web 应用程序可以使用容器提供的的资源，在这个案例中需要并配置一个 LoginService：</p>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.lang.management.ManagementFactory;

import org.eclipse.jetty.jmx.MBeanContainer;
import org.eclipse.jetty.security.HashLoginService;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.handler.AllowSymLinkAliasChecker;
import org.eclipse.jetty.webapp.WebAppContext;

public class OneWebApp
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        // Create a basic jetty server object that will listen on port 8080.
        // Note that if you set this to port 0 then a randomly available port
        // will be assigned that you can either look in the logs for the port,
        // or programmatically obtain it for use in test cases.
        Server server = new Server(8080);

        // Setup JMX
        MBeanContainer mbContainer = new MBeanContainer(
                ManagementFactory.getPlatformMBeanServer());
        server.addBean(mbContainer);

        // The WebAppContext is the entity that controls the environment in
        // which a web application lives and breathes. In this example the
        // context path is being set to &quot;/&quot; so it is suitable for serving root
        // context requests and then we see it setting the location of the war.
        // A whole host of other configurations are available, ranging from
        // configuring to support annotation scanning in the webapp (through
        // PlusConfiguration) to choosing where the webapp will unpack itself.
        WebAppContext webapp = new WebAppContext();
        webapp.setContextPath(&quot;/&quot;);
        File warFile = new File(
                &quot;../../tests/test-jmx/jmx-webapp/target/jmx-webapp&quot;);
        webapp.setWar(warFile.getAbsolutePath());

        // A WebAppContext is a ContextHandler as well so it needs to be set to
        // the server so it is aware of where to send the appropriate requests.
        server.setHandler(webapp);

        // Start things up!
        server.start();

        // The use of server.join() the will make the current thread join and
        // wait until the server is done executing.
        // See http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#join()
        server.join();
    &#125;
&#125;
</code></pre>
<h3 id="喜欢-Jetty-XML"><a href="#喜欢-Jetty-XML" class="headerlink" title="喜欢 Jetty XML"></a>喜欢 Jetty XML</h3><p>配置 Jetty 服务器实例的典型方式是通过 jetty.xml 关联配置文件。然而 Jetty XML 配置格式只是在代码中可以做的简单的表达；也可以很简单的写嵌入代码准确实现 jetty.xml 配置。下面的 <a target="_blank" rel="noopener" href="http://download.eclipse.org/jetty/stable-9/xref/org/eclipse/jetty/embedded/LikeJettyXml.html">LikeJettyXml 示例</a> 在代码中呈现了从配置文件获取的行为：</p>
<ul>
<li>jetty.xml</li>
<li>jetty-jmx.xml</li>
<li>jetty-http.xml</li>
<li>jetty-https.xml</li>
<li>jetty-deploy.xml</li>
<li>jetty-stats.xml</li>
<li>jetty-requestlog.xml</li>
<li>jetty-lowresources.xml</li>
<li>test-realm.xml</li>
</ul>
<pre><code>//
//  ========================================================================
//  Copyright (c) 1995-2016 Mort Bay Consulting Pty. Ltd.
//  ------------------------------------------------------------------------
//  All rights reserved. This program and the accompanying materials
//  are made available under the terms of the Eclipse Public License v1.0
//  and Apache License v2.0 which accompanies this distribution.
//
//      The Eclipse Public License is available at
//      http://www.eclipse.org/legal/epl-v10.html
//
//      The Apache License v2.0 is available at
//      http://www.opensource.org/licenses/apache2.0.php
//
//  You may elect to redistribute this code under either of these licenses.
//  ========================================================================
//

package org.eclipse.jetty.embedded;

import java.io.File;
import java.io.FileNotFoundException;
import java.lang.management.ManagementFactory;

import org.eclipse.jetty.deploy.DeploymentManager;
import org.eclipse.jetty.deploy.PropertiesConfigurationManager;
import org.eclipse.jetty.deploy.bindings.DebugListenerBinding;
import org.eclipse.jetty.deploy.providers.WebAppProvider;
import org.eclipse.jetty.http.HttpVersion;
import org.eclipse.jetty.jmx.MBeanContainer;
import org.eclipse.jetty.security.HashLoginService;
import org.eclipse.jetty.server.DebugListener;
import org.eclipse.jetty.server.Handler;
import org.eclipse.jetty.server.HttpConfiguration;
import org.eclipse.jetty.server.HttpConnectionFactory;
import org.eclipse.jetty.server.LowResourceMonitor;
import org.eclipse.jetty.server.NCSARequestLog;
import org.eclipse.jetty.server.SecureRequestCustomizer;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.server.SslConnectionFactory;
import org.eclipse.jetty.server.handler.ContextHandlerCollection;
import org.eclipse.jetty.server.handler.DefaultHandler;
import org.eclipse.jetty.server.handler.HandlerCollection;
import org.eclipse.jetty.server.handler.RequestLogHandler;
import org.eclipse.jetty.server.handler.StatisticsHandler;
import org.eclipse.jetty.util.ssl.SslContextFactory;
import org.eclipse.jetty.util.thread.QueuedThreadPool;
import org.eclipse.jetty.util.thread.ScheduledExecutorScheduler;
import org.eclipse.jetty.webapp.Configuration;

/**
 * Starts the Jetty Distribution&#39;s demo-base directory using entirely
 * embedded jetty techniques.
 */
public class LikeJettyXml
&#123;
    public static void main( String[] args ) throws Exception
    &#123;
        // Path to as-built jetty-distribution directory
        String jettyHomeBuild = &quot;../../jetty-distribution/target/distribution&quot;;

        // Find jetty home and base directories
        String homePath = System.getProperty(&quot;jetty.home&quot;, jettyHomeBuild);
        File homeDir = new File(homePath);
        if (!homeDir.exists())
        &#123;
            throw new FileNotFoundException(homeDir.getAbsolutePath());
        &#125;
        String basePath = System.getProperty(&quot;jetty.base&quot;, homeDir + &quot;/demo-base&quot;);
        File baseDir = new File(basePath);
        if(!baseDir.exists())
        &#123;
            throw new FileNotFoundException(baseDir.getAbsolutePath());
        &#125;

        // Configure jetty.home and jetty.base system properties
        String jetty_home = homeDir.getAbsolutePath();
        String jetty_base = baseDir.getAbsolutePath();
        System.setProperty(&quot;jetty.home&quot;, jetty_home);
        System.setProperty(&quot;jetty.base&quot;, jetty_base);


        // === jetty.xml ===
        // Setup Threadpool
        QueuedThreadPool threadPool = new QueuedThreadPool();
        threadPool.setMaxThreads(500);

        // Server
        Server server = new Server(threadPool);

        // Scheduler
        server.addBean(new ScheduledExecutorScheduler());

        // HTTP Configuration
        HttpConfiguration http_config = new HttpConfiguration();
        http_config.setSecureScheme(&quot;https&quot;);
        http_config.setSecurePort(8443);
        http_config.setOutputBufferSize(32768);
        http_config.setRequestHeaderSize(8192);
        http_config.setResponseHeaderSize(8192);
        http_config.setSendServerVersion(true);
        http_config.setSendDateHeader(false);
        // httpConfig.addCustomizer(new ForwardedRequestCustomizer());

        // Handler Structure
        HandlerCollection handlers = new HandlerCollection();
        ContextHandlerCollection contexts = new ContextHandlerCollection();
        handlers.setHandlers(new Handler[] &#123; contexts, new DefaultHandler() &#125;);
        server.setHandler(handlers);

        // Extra options
        server.setDumpAfterStart(false);
        server.setDumpBeforeStop(false);
        server.setStopAtShutdown(true);

        // === jetty-jmx.xml ===
        MBeanContainer mbContainer = new MBeanContainer(
                ManagementFactory.getPlatformMBeanServer());
        server.addBean(mbContainer);


        // === jetty-http.xml ===
        ServerConnector http = new ServerConnector(server,
                new HttpConnectionFactory(http_config));
        http.setPort(8080);
        http.setIdleTimeout(30000);
        server.addConnector(http);


        // === jetty-https.xml ===
        // SSL Context Factory
        SslContextFactory sslContextFactory = new SslContextFactory();
        sslContextFactory.setKeyStorePath(jetty_home + &quot;/../../../jetty-server/src/test/config/etc/keystore&quot;);
        sslContextFactory.setKeyStorePassword(&quot;OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4&quot;);
        sslContextFactory.setKeyManagerPassword(&quot;OBF:1u2u1wml1z7s1z7a1wnl1u2g&quot;);
        sslContextFactory.setTrustStorePath(jetty_home + &quot;/../../../jetty-server/src/test/config/etc/keystore&quot;);
        sslContextFactory.setTrustStorePassword(&quot;OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4&quot;);
        sslContextFactory.setExcludeCipherSuites(&quot;SSL_RSA_WITH_DES_CBC_SHA&quot;,
                &quot;SSL_DHE_RSA_WITH_DES_CBC_SHA&quot;, &quot;SSL_DHE_DSS_WITH_DES_CBC_SHA&quot;,
                &quot;SSL_RSA_EXPORT_WITH_RC4_40_MD5&quot;,
                &quot;SSL_RSA_EXPORT_WITH_DES40_CBC_SHA&quot;,
                &quot;SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA&quot;,
                &quot;SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA&quot;);

        // SSL HTTP Configuration
        HttpConfiguration https_config = new HttpConfiguration(http_config);
        https_config.addCustomizer(new SecureRequestCustomizer());

        // SSL Connector
        ServerConnector sslConnector = new ServerConnector(server,
            new SslConnectionFactory(sslContextFactory,HttpVersion.HTTP_1_1.asString()),
            new HttpConnectionFactory(https_config));
        sslConnector.setPort(8443);
        server.addConnector(sslConnector);


        // === jetty-deploy.xml ===
        DeploymentManager deployer = new DeploymentManager();
        DebugListener debug = new DebugListener(System.out,true,true,true);
        server.addBean(debug);        
        deployer.addLifeCycleBinding(new DebugListenerBinding(debug));
        deployer.setContexts(contexts);
        deployer.setContextAttribute(
                &quot;org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern&quot;,
                &quot;.*/servlet-api-[^/]*\\.jar$&quot;);

        WebAppProvider webapp_provider = new WebAppProvider();
        webapp_provider.setMonitoredDirName(jetty_base + &quot;/webapps&quot;);
        webapp_provider.setDefaultsDescriptor(jetty_home + &quot;/etc/webdefault.xml&quot;);
        webapp_provider.setScanInterval(1);
        webapp_provider.setExtractWars(true);
        webapp_provider.setConfigurationManager(new PropertiesConfigurationManager());

        deployer.addAppProvider(webapp_provider);
        server.addBean(deployer);

        // === setup jetty plus ==
        Configuration.ClassList.setServerDefault(server).addAfter(
                &quot;org.eclipse.jetty.webapp.FragmentConfiguration&quot;,
                &quot;org.eclipse.jetty.plus.webapp.EnvConfiguration&quot;,
                &quot;org.eclipse.jetty.plus.webapp.PlusConfiguration&quot;);

        // === jetty-stats.xml ===
        StatisticsHandler stats = new StatisticsHandler();
        stats.setHandler(server.getHandler());
        server.setHandler(stats);


        // === jetty-requestlog.xml ===
        NCSARequestLog requestLog = new NCSARequestLog();
        requestLog.setFilename(jetty_home + &quot;/logs/yyyy_mm_dd.request.log&quot;);
        requestLog.setFilenameDateFormat(&quot;yyyy_MM_dd&quot;);
        requestLog.setRetainDays(90);
        requestLog.setAppend(true);
        requestLog.setExtended(true);
        requestLog.setLogCookies(false);
        requestLog.setLogTimeZone(&quot;GMT&quot;);
        RequestLogHandler requestLogHandler = new RequestLogHandler();
        requestLogHandler.setRequestLog(requestLog);
        handlers.addHandler(requestLogHandler);


        // === jetty-lowresources.xml ===
        LowResourceMonitor lowResourcesMonitor=new LowResourceMonitor(server);
        lowResourcesMonitor.setPeriod(1000);
        lowResourcesMonitor.setLowResourcesIdleTimeout(200);
        lowResourcesMonitor.setMonitorThreads(true);
        lowResourcesMonitor.setMaxConnections(0);
        lowResourcesMonitor.setMaxMemory(0);
        lowResourcesMonitor.setMaxLowResourcesTime(5000);
        server.addBean(lowResourcesMonitor);


        // === test-realm.xml ===
        HashLoginService login = new HashLoginService();
        login.setName(&quot;Test Realm&quot;);
        login.setConfig(jetty_base + &quot;/etc/realm.properties&quot;);
        login.setHotReload(false);
        server.addBean(login);

        // Start the server
        server.start();
        server.join();
    &#125;
&#125;
</code></pre>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/images/wechat.jpg">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Jetty/" rel="tag"># Jetty</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2016/04/10/Jetty-%E5%B5%8C%E5%85%A5%E5%BC%8F-HelloWorld/" rel="prev" title="Jetty 嵌入式 HelloWorld">
                  <i class="fa fa-chevron-left"></i> Jetty 嵌入式 HelloWorld
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2016/04/16/Ubuntu-%E5%AE%89%E8%A3%85-MongoDB/" rel="next" title="Ubuntu 15.10 安装 MongoDB">
                  Ubuntu 15.10 安装 MongoDB <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一张假钞</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"jrvDEw4g5DJT4x0YfGPEm0MT-gzGzoHsz","app_key":"65zbvF5eSp8XmEcCPeiszS3m","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>



</body>
</html>
